# Module Starter - Services Symfony
# Documentation: https://devdocs.prestashop.com/8/modules/concepts/services/

services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false
        bind:
            $modulePath: '%kernel.project_dir%/modules/wepresta_acf'

    # =========================================================================
    # Auto-registration
    # =========================================================================

    # Application layer
    WeprestaAcf\Application\:
        resource: '../src/Application/*'
        exclude:
            - '../src/Application/Form/'

    # Infrastructure layer
    WeprestaAcf\Infrastructure\:
        resource: '../src/Infrastructure/*'
        exclude:
            - '../src/Infrastructure/Api/'

    # Presentation layer - Controllers only (Grids are configured explicitly below)
    WeprestaAcf\Presentation\Controller\:
        resource: '../src/Presentation/Controller/*'
        tags: ['controller.service_arguments']

    # =========================================================================
    # Explicit service definitions
    # =========================================================================

    # Configuration Adapter
    WeprestaAcf\Infrastructure\Adapter\ConfigurationAdapter:
        public: true

    # Repository
    WeprestaAcf\Infrastructure\Repository\WeprestaAcfRepository:
        arguments:
            $db: '@=service("prestashop.adapter.legacy.context").getContext().database'
        public: true

    WeprestaAcf\Domain\Repository\WeprestaAcfRepositoryInterface:
        alias: WeprestaAcf\Infrastructure\Repository\WeprestaAcfRepository

    # Main Service
    WeprestaAcf\Application\Service\WeprestaAcfService:
        arguments:
            $repository: '@WeprestaAcf\Domain\Repository\WeprestaAcfRepositoryInterface'
            $config: '@WeprestaAcf\Infrastructure\Adapter\ConfigurationAdapter'
            $logger: '@?logger'
        public: true

    # Alias pour faciliter l'injection
    wepresta_acf.service:
        alias: WeprestaAcf\Application\Service\WeprestaAcfService
        public: true

    # =========================================================================
    # Event Subscribers
    # =========================================================================

    WeprestaAcf\Infrastructure\EventSubscriber\ProductEventSubscriber:
        tags:
            - { name: kernel.event_subscriber }

    WeprestaAcf\Infrastructure\EventSubscriber\OrderEventSubscriber:
        tags:
            - { name: kernel.event_subscriber }

    # =========================================================================
    # Grid Framework
    # =========================================================================
    # 
    # Pour cr√©er un Grid, voir: src/Presentation/Grid/.gitkeep
    # 
    # Exemple de configuration:
    #
    # WeprestaAcf\Presentation\Grid\MyEntityGridDefinitionFactory:
    #     parent: 'prestashop.core.grid.definition.factory.abstract_grid_definition'
    #     public: true
    #
    # WeprestaAcf\Presentation\Grid\MyEntityGridQueryBuilder:
    #     arguments:
    #         $connection: '@doctrine.dbal.default_connection'
    #         $dbPrefix: '%database_prefix%'
    #
    # wepresta_acf.grid.data_provider:
    #     class: 'PrestaShop\PrestaShop\Core\Grid\Data\Factory\DoctrineGridDataFactory'
    #     arguments:
    #         $gridQueryBuilder: '@WeprestaAcf\Presentation\Grid\MyEntityGridQueryBuilder'
    #         $hookDispatcher: '@prestashop.core.hook.dispatcher'
    #         $queryParser: '@prestashop.core.grid.query.doctrine_query_parser'
    #         $gridId: 'my_entity'
    #
    # wepresta_acf.grid.factory:
    #     class: 'PrestaShop\PrestaShop\Core\Grid\GridFactory'
    #     arguments:
    #         $definitionFactory: '@WeprestaAcf\Presentation\Grid\MyEntityGridDefinitionFactory'
    #         $dataFactory: '@wepresta_acf.grid.data_provider'
    #         $filterFormFactory: '@prestashop.core.grid.filter.form_factory'
    #         $hookDispatcher: '@prestashop.core.hook.dispatcher'

    # =========================================================================
    # API Controllers
    # =========================================================================

    WeprestaAcf\Infrastructure\Api\ApiController:
        arguments:
            $service: '@WeprestaAcf\Application\Service\WeprestaAcfService'
            $config: '@WeprestaAcf\Infrastructure\Adapter\ConfigurationAdapter'
        tags:
            - { name: controller.service_arguments }
        public: true

    # =========================================================================
    # Forms
    # =========================================================================

    WeprestaAcf\Application\Form\ConfigurationType:
        parent: 'form.type.translatable.aware'
        public: true
        tags:
            - { name: form.type }
