# WePresta ACF - Services Symfony

imports:
    - { resource: '../src/Wedev/Extension/UI/config/services_ui.yml' }
    - { resource: '../src/Wedev/Extension/Events/config/services_events.yml' }
    - { resource: '../src/Wedev/Extension/EntityFields/config/services_entityfields.yml' }

services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false
        bind:
            $modulePath: '%kernel.project_dir%/modules/wepresta_acf'

    # =========================================================================
    # Auto-registration
    # =========================================================================

    WeprestaAcf\Application\:
        resource: '../src/Application/*'
        exclude:
            - '../src/Application/Form/'
            - '../src/Application/FieldType/'
            - '../src/Application/Brick/'

    WeprestaAcf\Infrastructure\:
        resource: '../src/Infrastructure/*'
        exclude:
            - '../src/Infrastructure/Api/'
            - '../src/Infrastructure/Adapter/'

    WeprestaAcf\Presentation\Controller\:
        resource: '../src/Presentation/Controller/*'
        tags: ['controller.service_arguments']

    # =========================================================================
    # Domain Repository Interfaces
    # =========================================================================

    WeprestaAcf\Domain\Repository\AcfGroupRepositoryInterface:
        alias: WeprestaAcf\Infrastructure\Repository\AcfGroupRepository

    WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface:
        alias: WeprestaAcf\Infrastructure\Repository\AcfFieldRepository

    WeprestaAcf\Domain\Repository\AcfFieldValueRepositoryInterface:
        alias: WeprestaAcf\Infrastructure\Repository\AcfFieldValueRepository

    # =========================================================================
    # Repositories (Public for service container access)
    # =========================================================================

    WeprestaAcf\Infrastructure\Repository\AcfGroupRepository:
        public: true

    WeprestaAcf\Infrastructure\Repository\AcfFieldRepository:
        public: true

    WeprestaAcf\Infrastructure\Repository\AcfFieldValueRepository:
        public: true

    # =========================================================================
    # Services
    # =========================================================================

    WeprestaAcf\Application\Service\FieldTypeRegistry:
        public: true

    WeprestaAcf\Application\Service\ValueProvider:
        arguments:
            $valueRepository: '@WeprestaAcf\Domain\Repository\AcfFieldValueRepositoryInterface'
        public: true

    WeprestaAcf\Application\Service\ValueHandler:
        arguments:
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
            $valueRepository: '@WeprestaAcf\Domain\Repository\AcfFieldValueRepositoryInterface'
            $fieldTypeRegistry: '@WeprestaAcf\Application\Service\FieldTypeRegistry'
        public: true

    WeprestaAcf\Application\Service\SlugGenerator:
        public: true

    WeprestaAcf\Application\Service\FileUploadService:
        arguments:
            $moduleDir: '%kernel.project_dir%/modules/wepresta_acf/'
        public: true

    WeprestaAcf\Application\Service\AcfServiceContainer:
        public: true

    WeprestaAcf\Application\Service\FormModifierService:
        arguments:
            $entityFieldRegistry: '@wedev.entity_field_registry'
            $locationProviderRegistry: '@WeprestaAcf\Application\Provider\LocationProviderRegistry'
            $groupRepository: '@WeprestaAcf\Domain\Repository\AcfGroupRepositoryInterface'
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
            $fieldTypeRegistry: '@WeprestaAcf\Application\Service\FieldTypeRegistry'
            $valueProvider: '@WeprestaAcf\Application\Service\ValueProvider'
            $valueHandler: '@WeprestaAcf\Application\Service\ValueHandler'
            $twig: '@twig'
        public: true

    # ACF Container FormType for Symfony forms
    WeprestaAcf\Application\Form\Type\AcfContainerType:
        tags: ['form.type']

    WeprestaAcf\Application\Service\EntityFieldService:
        arguments:
            $entityFieldRegistry: '@wedev.entity_field_registry'
            $locationProviderRegistry: '@WeprestaAcf\Application\Provider\LocationProviderRegistry'
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
            $valueRepository: '@WeprestaAcf\Domain\Repository\AcfFieldValueRepositoryInterface'
            $fieldTypeRegistry: '@WeprestaAcf\Application\Service\FieldTypeRegistry'
            $valueProvider: '@WeprestaAcf\Application\Service\ValueProvider'
            $valueHandler: '@WeprestaAcf\Application\Service\ValueHandler'
            $fileUploadService: '@WeprestaAcf\Application\Service\FileUploadService'
        public: true

    # =========================================================================
    # Core Adapters (from Wedev/Core)
    # =========================================================================

    WeprestaAcf\Wedev\Core\Adapter\ConfigurationAdapter:
        public: true

    WeprestaAcf\Wedev\Core\Adapter\ContextAdapter:
        public: true

    WeprestaAcf\Wedev\Core\Adapter\ShopAdapter:
        public: true

    # =========================================================================
    # API Controllers
    # =========================================================================

    WeprestaAcf\Infrastructure\Api\GroupApiController:
        arguments:
            $groupRepository: '@WeprestaAcf\Domain\Repository\AcfGroupRepositoryInterface'
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
            $slugGenerator: '@WeprestaAcf\Application\Service\SlugGenerator'
        tags: ['controller.service_arguments']
        public: true

    WeprestaAcf\Infrastructure\Api\FieldApiController:
        arguments:
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
            $groupRepository: '@WeprestaAcf\Domain\Repository\AcfGroupRepositoryInterface'
            $valueRepository: '@WeprestaAcf\Domain\Repository\AcfFieldValueRepositoryInterface'
            $slugGenerator: '@WeprestaAcf\Application\Service\SlugGenerator'
        tags: ['controller.service_arguments']
        public: true

    WeprestaAcf\Infrastructure\Api\RelationApiController:
        tags: ['controller.service_arguments']
        public: true

    WeprestaAcf\Infrastructure\Api\UtilityApiController:
        arguments:
            $fieldTypeRegistry: '@WeprestaAcf\Application\Service\FieldTypeRegistry'
            $slugGenerator: '@WeprestaAcf\Application\Service\SlugGenerator'
        tags: ['controller.service_arguments']
        public: true

    WeprestaAcf\Infrastructure\Api\ValueApiController:
        arguments:
            $valueHandler: '@WeprestaAcf\Application\Service\ValueHandler'
            $valueProvider: '@WeprestaAcf\Application\Service\ValueProvider'
        tags: ['controller.service_arguments']
        public: true

    # =========================================================================
    # Domain Event Dispatcher (from Wedev/Extension/Events)
    # =========================================================================

    # Alias for module-specific access
    wepresta_acf.event_dispatcher:
        alias: WeprestaAcf\Wedev\Extension\Events\DomainEventDispatcher
        public: true

    # =========================================================================
    # Brick Discovery
    # =========================================================================

    WeprestaAcf\Application\Brick\AcfBrickDiscovery:
        public: true

    wepresta_acf.brick_discovery:
        alias: WeprestaAcf\Application\Brick\AcfBrickDiscovery
        public: true

    # =========================================================================
    # Providers
    # =========================================================================

    WeprestaAcf\Application\Provider\LocationProviderRegistry:
        arguments:
            $entityFieldRegistry: '@wedev.entity_field_registry'
        calls:
            - method: setEntityFieldProviders
              arguments:
                  - ['@WeprestaAcf\Application\Provider\EntityField\ProductEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\CategoryEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\CustomerEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\CustomerAddressEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\CustomerGroupEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\BrandEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\SupplierEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\CmsPageEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\CmsCategoryEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\LanguageEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\ZoneEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\CountryEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\StateEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\CurrencyEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\OrderEntityFieldProvider',
                     '@WeprestaAcf\Application\Provider\EntityField\CartEntityFieldProvider']
        public: true

    # =========================================================================
    # Entity Field Providers
    # =========================================================================

    WeprestaAcf\Application\Provider\EntityField\ProductEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\CategoryEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\CustomerEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\CustomerAddressEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\CustomerGroupEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\BrandEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\SupplierEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\CmsPageEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\CmsCategoryEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\LanguageEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\ZoneEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\CountryEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\StateEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\CurrencyEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\OrderEntityFieldProvider:
        public: true

    WeprestaAcf\Application\Provider\EntityField\CartEntityFieldProvider:
        public: true

    # Service to register all entity field providers with the registry
    WeprestaAcf\Application\Service\EntityFieldRegistryInitializer:
        arguments:
            $registry: '@wedev.entity_field_registry'
            $providers:
                - '@WeprestaAcf\Application\Provider\EntityField\ProductEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\CategoryEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\CustomerEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\CustomerAddressEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\CustomerGroupEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\BrandEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\SupplierEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\CmsPageEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\CmsCategoryEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\LanguageEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\ZoneEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\CountryEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\StateEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\CurrencyEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\OrderEntityFieldProvider'
                - '@WeprestaAcf\Application\Provider\EntityField\CartEntityFieldProvider'
        tags: ['kernel.event_subscriber']
        public: true

    # =========================================================================
    # Template Export/Import
    # =========================================================================

    WeprestaAcf\Application\Template\FieldGroupExporter:
        arguments:
            $groupRepository: '@WeprestaAcf\Domain\Repository\AcfGroupRepositoryInterface'
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
        public: true

    WeprestaAcf\Application\Template\FieldGroupImporter:
        arguments:
            $groupRepository: '@WeprestaAcf\Domain\Repository\AcfGroupRepositoryInterface'
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
        public: true

    # =========================================================================
    # Presentation Controllers
    # =========================================================================

    WeprestaAcf\Presentation\Controller\Admin\BuilderController:
        arguments:
            $fieldTypeRegistry: '@WeprestaAcf\Application\Service\FieldTypeRegistry'
            $fieldTypeLoader: '@WeprestaAcf\Application\Service\FieldTypeLoader'
            $locationProviderRegistry: '@WeprestaAcf\Application\Provider\LocationProviderRegistry'
        tags: ['controller.service_arguments']
        public: true

    WeprestaAcf\Presentation\Controller\Admin\ConfigurationController:
        arguments:
            $config: '@WeprestaAcf\Wedev\Core\Adapter\ConfigurationAdapter'
            $syncService: '@WeprestaAcf\Application\Service\SyncService'
            $fieldTypeLoader: '@WeprestaAcf\Application\Service\FieldTypeLoader'
        tags: ['controller.service_arguments']
        public: true

    # =========================================================================
    # Sync Services
    # =========================================================================

    WeprestaAcf\Application\Service\SyncService:
        arguments:
            $groupRepository: '@WeprestaAcf\Domain\Repository\AcfGroupRepositoryInterface'
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
            $config: '@WeprestaAcf\Wedev\Core\Adapter\ConfigurationAdapter'
            $modulePath: '%kernel.project_dir%/modules/wepresta_acf'
        public: true

    WeprestaAcf\Application\Service\SyncStatusResolver:
        arguments:
            $syncService: '@WeprestaAcf\Application\Service\SyncService'
        public: true

    WeprestaAcf\Application\Service\FieldTypeLoader:
        arguments:
            $registry: '@WeprestaAcf\Application\Service\FieldTypeRegistry'
            $modulePath: '%kernel.project_dir%/modules/wepresta_acf'
            $brickDiscovery: '@WeprestaAcf\Application\Brick\AcfBrickDiscovery'
        public: true

    # =========================================================================
    # Sync API Controllers
    # =========================================================================

    WeprestaAcf\Infrastructure\Api\SyncApiController:
        arguments:
            $syncService: '@WeprestaAcf\Application\Service\SyncService'
            $statusResolver: '@WeprestaAcf\Application\Service\SyncStatusResolver'
        tags: ['controller.service_arguments']
        public: true

    WeprestaAcf\Infrastructure\Api\FieldTypeApiController:
        arguments:
            $registry: '@WeprestaAcf\Application\Service\FieldTypeRegistry'
            $loader: '@WeprestaAcf\Application\Service\FieldTypeLoader'
        tags: ['controller.service_arguments']
        public: true

    # =========================================================================
    # Form Types
    # =========================================================================

    WeprestaAcf\Application\Form\ConfigurationType:
        parent: 'form.type.translatable.aware'
        public: true

    WeprestaAcf\Application\Form\Type\AcfFieldsType:
        tags: ['form.type']
        public: true

