# WePresta ACF - Services Symfony

services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false
        bind:
            $modulePath: '%kernel.project_dir%/modules/wepresta_acf'

    # =========================================================================
    # Auto-registration
    # =========================================================================

    WeprestaAcf\Application\:
        resource: '../src/Application/*'
        exclude:
            - '../src/Application/Form/'
            - '../src/Application/FieldType/'

    WeprestaAcf\Infrastructure\:
        resource: '../src/Infrastructure/*'
        exclude:
            - '../src/Infrastructure/Api/'

    WeprestaAcf\Presentation\Controller\:
        resource: '../src/Presentation/Controller/*'
        tags: ['controller.service_arguments']

    # =========================================================================
    # Domain Repository Interfaces
    # =========================================================================

    WeprestaAcf\Domain\Repository\AcfGroupRepositoryInterface:
        alias: WeprestaAcf\Infrastructure\Repository\AcfGroupRepository

    WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface:
        alias: WeprestaAcf\Infrastructure\Repository\AcfFieldRepository

    WeprestaAcf\Domain\Repository\AcfFieldValueRepositoryInterface:
        alias: WeprestaAcf\Infrastructure\Repository\AcfFieldValueRepository

    # =========================================================================
    # Repositories (Public for service container access)
    # =========================================================================

    WeprestaAcf\Infrastructure\Repository\AcfGroupRepository:
        public: true

    WeprestaAcf\Infrastructure\Repository\AcfFieldRepository:
        public: true

    WeprestaAcf\Infrastructure\Repository\AcfFieldValueRepository:
        public: true

    # =========================================================================
    # Services
    # =========================================================================

    WeprestaAcf\Application\Service\FieldTypeRegistry:
        public: true

    WeprestaAcf\Application\Service\ValueProvider:
        arguments:
            $valueRepository: '@WeprestaAcf\Domain\Repository\AcfFieldValueRepositoryInterface'
        public: true

    WeprestaAcf\Application\Service\ValueHandler:
        arguments:
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
            $valueRepository: '@WeprestaAcf\Domain\Repository\AcfFieldValueRepositoryInterface'
            $fieldTypeRegistry: '@WeprestaAcf\Application\Service\FieldTypeRegistry'
        public: true

    WeprestaAcf\Application\Service\SlugGenerator:
        public: true

    WeprestaAcf\Application\Service\FileUploadService:
        arguments:
            $moduleDir: '%kernel.project_dir%/modules/wepresta_acf/'
        public: true

    WeprestaAcf\Application\Service\AcfServiceContainer:
        public: true

    WeprestaAcf\Infrastructure\Adapter\ConfigurationAdapter:
        public: true

    # =========================================================================
    # API Controllers
    # =========================================================================

    WeprestaAcf\Infrastructure\Api\GroupApiController:
        arguments:
            $groupRepository: '@WeprestaAcf\Domain\Repository\AcfGroupRepositoryInterface'
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
            $slugGenerator: '@WeprestaAcf\Application\Service\SlugGenerator'
        tags: ['controller.service_arguments']
        public: true

    WeprestaAcf\Infrastructure\Api\FieldApiController:
        arguments:
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
            $groupRepository: '@WeprestaAcf\Domain\Repository\AcfGroupRepositoryInterface'
            $slugGenerator: '@WeprestaAcf\Application\Service\SlugGenerator'
        tags: ['controller.service_arguments']
        public: true

    WeprestaAcf\Infrastructure\Api\UtilityApiController:
        arguments:
            $fieldTypeRegistry: '@WeprestaAcf\Application\Service\FieldTypeRegistry'
        tags: ['controller.service_arguments']
        public: true

    WeprestaAcf\Infrastructure\Api\ValueApiController:
        arguments:
            $valueHandler: '@WeprestaAcf\Application\Service\ValueHandler'
            $valueProvider: '@WeprestaAcf\Application\Service\ValueProvider'
        tags: ['controller.service_arguments']
        public: true

    # =========================================================================
    # Event Bus
    # =========================================================================

    WeprestaAcf\Domain\Event\EventBus:
        public: true

    # =========================================================================
    # Providers
    # =========================================================================

    WeprestaAcf\Application\Provider\LocationProviderRegistry:
        public: true

    # =========================================================================
    # Template Export/Import
    # =========================================================================

    WeprestaAcf\Application\Template\FieldGroupExporter:
        arguments:
            $groupRepository: '@WeprestaAcf\Domain\Repository\AcfGroupRepositoryInterface'
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
        public: true

    WeprestaAcf\Application\Template\FieldGroupImporter:
        arguments:
            $groupRepository: '@WeprestaAcf\Domain\Repository\AcfGroupRepositoryInterface'
            $fieldRepository: '@WeprestaAcf\Domain\Repository\AcfFieldRepositoryInterface'
        public: true

    # =========================================================================
    # Presentation Controllers
    # =========================================================================

    WeprestaAcf\Presentation\Controller\Admin\BuilderController:
        arguments:
            $fieldTypeRegistry: '@WeprestaAcf\Application\Service\FieldTypeRegistry'
        tags: ['controller.service_arguments']
        public: true
