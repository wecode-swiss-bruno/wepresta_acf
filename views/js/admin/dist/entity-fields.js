import{j as U,a as V,r as F,v as O,w as P,f as $,k as d,p as r,l as y,s as f,A as m,F as A,y as b,u as g,z as j,U as z,_ as J,V as M,C as B}from"./acf-AcfFieldRenderer.vue_vue_type_script_setup_true_lang.js";const D=["data-entity-type","data-entity-id"],q={key:0,class:"alert alert-info"},H=["data-group-id"],G={class:"card-header bg-light"},R={class:"mb-0"},X={key:0,class:"text-muted mb-0 mt-1 small"},K={class:"card-body"},Q={key:0,class:"text-muted"},W={key:1},Y=["name","value"],Z={key:1,class:"acf-save-status mt-2"},ee={key:0,class:"text-info"},te={key:1,class:"text-danger"},ae={key:2,class:"text-success"},se=U({__name:"AcfEntityFields",props:{groups:{},initialValues:{},entityType:{},entityId:{},languages:{},defaultLanguage:{},apiUrl:{},shopId:{},csrfToken:{},autoSave:{type:Boolean},formNamePrefix:{}},emits:["update:values","save:success","save:error"],setup(e,{expose:t,emit:i}){const a=e,u=i,n=V({}),l=F(!1),v=F(null),k=F(null);let I=null;O(()=>{a.initialValues&&Object.assign(n,a.initialValues)}),P(()=>a.initialValues,s=>{s&&Object.assign(n,s)},{deep:!0});function _(s){return n[s]??null}function T(s,o){n[s]=o,u("update:values",{...n}),a.autoSave&&E()}function E(){I&&clearTimeout(I),I=setTimeout(()=>{x()},1e3)}async function x(){if(!(!a.apiUrl||l.value)){l.value=!0,v.value=null;try{const s=await fetch(a.apiUrl,{method:"POST",headers:{"Content-Type":"application/json",...a.csrfToken?{"X-CSRF-Token":a.csrfToken}:{}},body:JSON.stringify({entity_type:a.entityType,entity_id:a.entityId,shop_id:a.shopId,values:n})});if(!s.ok)throw new Error(`Save failed: ${s.statusText}`);const o=await s.json();k.value=new Date,u("save:success",o)}catch(s){v.value=s instanceof Error?s.message:"Unknown error",u("save:error",s instanceof Error?s:new Error("Unknown error"))}finally{l.value=!1}}}function L(s){return`${a.formNamePrefix||"acf"}[${s}]`}const w=$(()=>a.groups.some(s=>s.fields&&s.fields.length>0));return t({values:n,saveValues:x,getFieldValue:_,setFieldValue:T}),(s,o)=>(r(),d("div",{class:"acf-entity-fields","data-entity-type":e.entityType,"data-entity-id":e.entityId},[w.value?y("",!0):(r(),d("div",q,[...o[0]||(o[0]=[f("i",{class:"material-icons"},"info",-1),m(" No custom fields configured for this entity type. ",-1)])])),(r(!0),d(A,null,b(e.groups,c=>(r(),d("div",{key:c.id,class:"acf-group card mb-3","data-group-id":c.id},[f("div",G,[f("h4",R,[o[1]||(o[1]=f("i",{class:"material-icons mr-2",style:{"vertical-align":"middle","font-size":"20px"}},"layers",-1)),m(" "+g(c.title||"Untitled Group"),1)]),c.description?(r(),d("p",X,g(c.description),1)):y("",!0)]),f("div",K,[!c.fields||c.fields.length===0?(r(),d("div",Q," No fields in this group. ")):(r(),d("div",W,[(r(!0),d(A,null,b(c.fields,p=>(r(),d("div",{key:p.id,class:"acf-field-container mb-3"},[j(z,{field:p,"model-value":_(p.id),languages:e.languages,"default-language":e.defaultLanguage,"onUpdate:modelValue":C=>T(p.id,C)},null,8,["field","model-value","languages","default-language","onUpdate:modelValue"]),e.formNamePrefix?(r(),d("input",{key:0,type:"hidden",name:L(p.id),value:JSON.stringify(_(p.id))},null,8,Y)):y("",!0)]))),128))]))])],8,H))),128)),e.autoSave?(r(),d("div",Z,[l.value?(r(),d("span",ee,[...o[2]||(o[2]=[f("i",{class:"material-icons spinning"},"sync",-1),m(" Saving... ",-1)])])):v.value?(r(),d("span",te,[o[3]||(o[3]=f("i",{class:"material-icons"},"error",-1)),m(" "+g(v.value),1)])):k.value?(r(),d("span",ae,[o[4]||(o[4]=f("i",{class:"material-icons"},"check_circle",-1)),m(" Saved "+g(k.value.toLocaleTimeString()),1)])):y("",!0)])):y("",!0)],8,D))}}),ne=J(se,[["__scopeId","data-v-064dac0e"]]);function N(e,t=null){if(!e)return t;try{return JSON.parse(e)}catch(i){return console.error("ACF: Failed to parse JSON:",i),t}}function h(e){var u,n;const t={groups:N(e.dataset.groups,[]),values:N(e.dataset.values,{}),entityType:e.dataset.entityType||"unknown",entityId:parseInt(e.dataset.entityId||"0",10),apiUrl:e.dataset.apiUrl,languages:N(e.dataset.languages,[]),defaultLangId:parseInt(e.dataset.defaultLangId||"1",10),shopId:parseInt(e.dataset.shopId||"1",10),formNamePrefix:e.dataset.formNamePrefix||"acf"},i=((u=t.languages)==null?void 0:u.find(l=>l.id_lang===t.defaultLangId||l.is_default))||((n=t.languages)==null?void 0:n[0]);M({name:"AcfEntityFieldsApp",setup(){return()=>B(ne,{groups:t.groups,initialValues:t.values,entityType:t.entityType,entityId:t.entityId,apiUrl:t.apiUrl,languages:t.languages,defaultLanguage:i,shopId:t.shopId,formNamePrefix:t.formNamePrefix,autoSave:!1,"onUpdate:values":l=>{ie(e,l,t.formNamePrefix)}})}}).mount(e),e.classList.add("acf-vue-initialized"),console.log(`ACF: Mounted entity fields app for ${t.entityType} #${t.entityId}`)}function ie(e,t,i){let a=e.querySelector(".acf-hidden-inputs");a||(a=document.createElement("div"),a.className="acf-hidden-inputs",a.style.display="none",e.appendChild(a)),a.innerHTML="";for(const[u,n]of Object.entries(t)){const l=document.createElement("input");l.type="hidden",l.name=`${i}[${u}]`,l.value=typeof n=="object"?JSON.stringify(n):String(n??""),a.appendChild(l)}}function S(){const e=document.querySelectorAll(".acf-entity-fields-vue-container:not(.acf-vue-initialized)");e.length!==0&&(console.log(`ACF: Found ${e.length} entity fields container(s)`),e.forEach(t=>{try{h(t)}catch(i){console.error("ACF: Failed to mount app:",i)}}))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S):S();const oe=new MutationObserver(e=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(i=>{i instanceof HTMLElement&&(i.classList.contains("acf-entity-fields-vue-container")&&(i.classList.contains("acf-vue-initialized")||h(i)),i.querySelectorAll(".acf-entity-fields-vue-container:not(.acf-vue-initialized)").forEach(u=>{try{h(u)}catch(n){console.error("ACF: Failed to mount app on dynamic container:",n)}}))})});oe.observe(document.body,{childList:!0,subtree:!0});window.initAcfEntityFields=S;window.mountAcfApp=h;
