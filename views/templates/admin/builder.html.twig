{% extends '@PrestaShop/Admin/layout.html.twig' %}

{# Import WEDEV UI Macros via relative path #}
{% import '@Modules/wepresta_acf/src/Wedev/Extension/UI/Twig/Macros/admin.html.twig' as ui %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    {# Admin SCSS compiled by Webpack Encore → views/dist/admin.css #}
    <link rel="stylesheet" href="/modules/wepresta_acf/views/dist/admin.css">
    {# Vue.js Builder CSS compiled by Vite → views/js/admin/dist/acf-main.css #}
    <link rel="stylesheet" href="/modules/wepresta_acf/views/js/admin/dist/acf-main.css">
{% endblock %}

{# Define toolbar buttons - rendered by PrestaShop Toolbar component #}
{# Note: PS Toolbar skips keys 'back' and 'modules-list', so use 'go-back' instead #}
{% set layoutHeaderToolbarBtn = {
    'add-group': {
        'href': '#',
        'desc': 'Add Group'|trans({}, 'Modules.Weprestaacf.Admin'),
        'icon': 'add_circle_outline',
        'class': 'btn-primary acf-toolbar-list-btn',
        'js': 'return false;'
    },
    'go-back': {
        'href': '#',
        'desc': 'Back'|trans({}, 'Admin.Actions'),
        'icon': 'arrow_back',
        'class': 'btn-outline-secondary acf-toolbar-edit-btn d-none',
        'js': 'return false;'
    },
    'save-group': {
        'href': '#',
        'desc': 'Save'|trans({}, 'Admin.Actions'),
        'icon': 'save',
        'class': 'btn-primary acf-toolbar-edit-btn d-none',
        'js': 'return false;'
    }
} %}

{% block content %}
    {# Include WEDEV UI Partials #}
    {% include '@Modules/wepresta_acf/src/Wedev/Extension/UI/Templates/admin/_partials/confirm-modal.html.twig' %}
    {% include '@Modules/wepresta_acf/src/Wedev/Extension/UI/Templates/admin/_partials/toasts.html.twig' %}

    {# Alerts container - populated by Vue but outside app for native styling #}
    <div id="acf-alerts-container"></div>

    <div id="acf-builder-app" data-module-url="{{ path('wepresta_acf_builder') }}">
        <div class="acf-loading text-center py-5">
            {{ ui.loader('md', 'primary') }}
            <p class="mt-2">{{ 'Loading ACF Builder...'|trans({}, 'Modules.Weprestaacf.Admin') }}</p>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        window.acfConfig = {
            apiUrl: '{{ url('wepresta_acf_api_groups_list') | split('/groups')[0] }}',
            token: '{{ csrf_token('wepresta_acf') }}',
            translations: {
                loading: '{{ 'Loading...'|trans({}, 'Admin.Global') }}',
                fieldGroups: '{{ 'Field Groups'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                addGroup: '{{ 'Add Group'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                noGroups: '{{ 'No field groups yet. Create your first one!'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                groupTitle: '{{ 'Title'|trans({}, 'Admin.Global') }}',
                groupSlug: '{{ 'Slug'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                fields: '{{ 'Fields'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                placementTab: '{{ 'Tab'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                active: '{{ 'Active'|trans({}, 'Admin.Global') }}',
                options: '{{ 'Options'|trans({}, 'Admin.Global') }}',
                untitled: '{{ 'Untitled'|trans({}, 'Admin.Global') }}',
                edit: '{{ 'Edit'|trans({}, 'Admin.Actions') }}',
                duplicate: '{{ 'Duplicate'|trans({}, 'Admin.Actions') }}',
                delete: '{{ 'Delete'|trans({}, 'Admin.Actions') }}',
                confirmDeleteGroup: '{{ 'Are you sure you want to delete this group?'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                addField: '{{ 'Add Field'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                noFields: '{{ 'No fields yet'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                selectField: '{{ 'Select a field type'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                selectFieldToEdit: '{{ 'Select a field to edit'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                save: '{{ 'Save'|trans({}, 'Admin.Actions') }}',
                back: '{{ 'Back'|trans({}, 'Admin.Actions') }}',
                general: '{{ 'General Settings'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                location: '{{ 'Location'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                locationRulesHelp: '{{ 'Define where this field group should appear.'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                settings: '{{ 'Settings'|trans({}, 'Admin.Global') }}',
                validation: '{{ 'Validation'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                presentation: '{{ 'Presentation'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                conditions: '{{ 'Conditions'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                fieldTitle: '{{ 'Field Title'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                fieldSlug: '{{ 'Field Name'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                fieldType: '{{ 'Field Type'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                fieldInstructions: '{{ 'Instructions'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                required: '{{ 'Required'|trans({}, 'Admin.Global') }}',
                minLength: '{{ 'Min Length'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                maxLength: '{{ 'Max Length'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                minValue: '{{ 'Min Value'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                maxValue: '{{ 'Max Value'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                pattern: '{{ 'Pattern'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                errorMessage: '{{ 'Error Message'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                wrapperWidth: '{{ 'Width'|trans({}, 'Admin.Global') }}',
                wrapperClass: '{{ 'CSS Class'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                wrapperId: '{{ 'CSS ID'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                frontendOptions: '{{ 'Frontend Options'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                translatable: '{{ 'Translatable'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                showOnFrontend: '{{ 'Show on Frontend'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                saving: '{{ 'Saving...'|trans({}, 'Admin.Global') }}',
                // Sync translations
                sync: '{{ 'Sync'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                syncActions: '{{ 'Sync Actions'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                pushToTheme: '{{ 'Push to Theme'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                pullFromTheme: '{{ 'Pull from Theme'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                exportJson: '{{ 'Export JSON'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                themeOnlyGroups: '{{ 'Groups available in theme'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                import: '{{ 'Import'|trans({}, 'Admin.Actions') }}',
                groupPushedSuccess: '{{ 'Group pushed to theme successfully'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                groupPulledSuccess: '{{ 'Group imported from theme successfully'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                syncError: '{{ 'Sync error'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                exportError: '{{ 'Export error'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                confirmPullFromTheme: '{{ 'Are you sure? This will overwrite the current group.'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                // Choice field translations
                choices: '{{ 'Choices'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                choicesHelp: '{{ 'Define the available options'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                addOption: '{{ 'Add Option'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                noChoices: '{{ 'No options defined yet'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                defaultValue: '{{ 'Default Value'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                allowMultiple: '{{ 'Allow Multiple'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                allowMultipleHelp: '{{ 'Allow selecting multiple values'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                selectDefaultHelp: '{{ 'Select the default option'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                none: '{{ 'None'|trans({}, 'Admin.Global') }}',
                // Seed translations
                seedTestData: '{{ 'Seed Test Data'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                seeding: '{{ 'Seeding...'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                confirmSeed: '{{ 'Create a test group with all field types? This will help you explore ACF features.'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                seedSuccess: '{{ 'Test data seeded successfully'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                seedSkipped: '{{ 'Test group already exists. Delete it first if you want to re-seed.'|trans({}, 'Modules.Weprestaacf.Admin') }}',
                seedError: '{{ 'Seed error'|trans({}, 'Modules.Weprestaacf.Admin') }}'
            },
            fieldTypes: {{ fieldTypes|json_encode|raw }},
            locations: {{ locations|json_encode|raw }},
            productTabs: [
                { value: 'extra', label: '{{ 'Extra Tab (ACF)'|trans({}, 'Modules.Weprestaacf.Admin') }}' },
                { value: 'description', label: '{{ 'Description'|trans({}, 'Admin.Catalog.Feature') }}' },
                { value: 'pricing', label: '{{ 'Pricing'|trans({}, 'Admin.Catalog.Feature') }}' },
                { value: 'seo', label: '{{ 'SEO'|trans({}, 'Admin.Catalog.Feature') }}' },
                { value: 'shipping', label: '{{ 'Shipping'|trans({}, 'Admin.Catalog.Feature') }}' },
                { value: 'options', label: '{{ 'Options'|trans({}, 'Admin.Catalog.Feature') }}' }
            ],
            layoutOptions: {
                widths: [
                    { value: '100', label: '100%' },
                    { value: '75', label: '75%' },
                    { value: '50', label: '50%' },
                    { value: '33', label: '33%' },
                    { value: '25', label: '25%' }
                ],
                positions: [
                    { value: 'before', label: '{{ 'Before'|trans({}, 'Modules.Weprestaacf.Admin') }}' },
                    { value: 'after', label: '{{ 'After'|trans({}, 'Modules.Weprestaacf.Admin') }}' }
                ]
            }
        };
    </script>
    <script src="/modules/wepresta_acf/views/js/admin/dist/acf-admin.js" defer></script>
{% endblock %}

