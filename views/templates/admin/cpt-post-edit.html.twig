{#
 # CPT Post Edit Template - Create/Edit post with ACF fields
 #}

{% extends '@PrestaShop/Admin/layout.html.twig' %}

{% block content %}
    <div class="container-fluid">
        <form method="post" class="cpt-post-form">
            <div class="row">
                <div class="col-lg-9">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-header-title">
                                {% if post %}
                                    {{ 'Edit Post'|trans({}, 'Modules.Weprestaacf.Admin') }}
                                {% else %}
                                    {{ 'New Post'|trans({}, 'Modules.Weprestaacf.Admin') }}
                                {% endif %}
                            </h3>
                        </div>
                        <div class="card-body">
                            {# Title #}
                            <div class="form-group">
                                <label for="post_title">{{ 'Title'|trans({}, 'Admin.Global') }} *</label>
                                <input type="text" 
                                       id="post_title" 
                                       name="title" 
                                       class="form-control" 
                                       value="{{ post ? post.title : '' }}" 
                                       required>
                            </div>

                            {# Slug #}
                            <div class="form-group">
                                <label for="post_slug">{{ 'Slug'|trans({}, 'Admin.Global') }} *</label>
                                <input type="text" 
                                       id="post_slug" 
                                       name="slug" 
                                       class="form-control" 
                                       value="{{ post ? post.slug : '' }}" 
                                       required>
                                <small class="form-text text-muted">
                                    {{ 'URL-friendly identifier'|trans({}, 'Modules.Weprestaacf.Admin') }}
                                </small>
                            </div>

                            {# ACF Fields #}
                            {% if type.acf_groups|length > 0 %}
                                <div class="acf-fields-section">
                                    <h4>{{ 'Custom Fields'|trans({}, 'Modules.Weprestaacf.Admin') }}</h4>
                                    {# ACF fields will be injected here via JavaScript or PHP #}
                                    <div id="acf-fields-container">
                                        {# Dynamic ACF field rendering #}
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    {# SEO Section #}
                    <div class="card mt-3">
                        <div class="card-header">
                            <h3 class="card-header-title">{{ 'SEO'|trans({}, 'Admin.Global') }}</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="seo_title">{{ 'SEO Title'|trans({}, 'Modules.Weprestaacf.Admin') }}</label>
                                <input type="text" 
                                       id="seo_title" 
                                       name="seo_title" 
                                       class="form-control" 
                                       value="{{ post ? post.seo_title : '' }}">
                            </div>

                            <div class="form-group">
                                <label for="seo_description">{{ 'SEO Description'|trans({}, 'Modules.Weprestaacf.Admin') }}</label>
                                <textarea id="seo_description" 
                                          name="seo_description" 
                                          class="form-control" 
                                          rows="3">{{ post ? post.seo_description : '' }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3">
                    {# Publish Box #}
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-header-title">{{ 'Publish'|trans({}, 'Admin.Actions') }}</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="post_status">{{ 'Status'|trans({}, 'Admin.Global') }}</label>
                                <select id="post_status" name="status" class="form-control">
                                    <option value="draft" {% if post and post.status == 'draft' %}selected{% endif %}>
                                        {{ 'Draft'|trans({}, 'Admin.Actions') }}
                                    </option>
                                    <option value="published" {% if post and post.status == 'published' %}selected{% endif %}>
                                        {{ 'Published'|trans({}, 'Admin.Actions') }}
                                    </option>
                                </select>
                            </div>

                            <div class="form-group">
                                <button type="submit" class="btn btn-primary btn-block">
                                    <i class="material-icons">save</i>
                                    {{ 'Save'|trans({}, 'Admin.Actions') }}
                                </button>
                            </div>

                            {% if post %}
                                <div class="form-text text-muted">
                                    <small>{{ 'Created:'|trans({}, 'Admin.Global') }} {{ post.date_add }}</small><br>
                                    <small>{{ 'Updated:'|trans({}, 'Admin.Global') }} {{ post.date_upd }}</small>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    {# Taxonomies #}
                    {% if taxonomies|length > 0 %}
                        {% for taxonomy in taxonomies %}
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h3 class="card-header-title">{{ taxonomy.name }}</h3>
                                </div>
                                <div class="card-body">
                                    <div class="taxonomy-terms">
                                        {% for term in taxonomy.terms %}
                                            <div class="form-check">
                                                <input type="checkbox" 
                                                       class="form-check-input" 
                                                       id="term_{{ term.id }}" 
                                                       name="terms[{{ taxonomy.id }}][]" 
                                                       value="{{ term.id }}"
                                                       {% if post and term.id in post.terms %}checked{% endif %}>
                                                <label class="form-check-label" for="term_{{ term.id }}">
                                                    {{ term.name }}
                                                </label>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </form>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        // Auto-generate slug from title
        document.getElementById('post_title').addEventListener('input', function() {
            const slug = this.value.toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/(^-|-$)/g, '');
            document.getElementById('post_slug').value = slug;
        });
    </script>
{% endblock %}
