{#
 # =============================================================================
 # WEDEV UI - Macros Twig Back-Office PrestaShop 9
 # =============================================================================
 # Utilisation: {% import '@WedevUI/Macros/admin.html.twig' as ui %}
 #
 # Ces macros utilisent exclusivement les classes Bootstrap 4 / UIKit PS9.
 # Aucun style custom n'est ajouté.
 # =============================================================================
 #}

{# -----------------------------------------------------------------------------
 # Card - Carte standard PrestaShop
 # Usage: {{ ui.card('Settings', 'settings', cardContent, cardFooter) }}
 # -------------------------------------------------------------------------- #}
{% macro card(title, icon, content, footer, headerClass) %}
<div class="card">
    {% if title %}
    <div class="card-header{{ headerClass ? ' ' ~ headerClass : '' }}">
        <h3 class="card-header-title">
            {% if icon %}<i class="material-icons mr-2">{{ icon }}</i>{% endif %}
            {{ title }}
        </h3>
    </div>
    {% endif %}
    <div class="card-body">
        {{ content|raw }}
    </div>
    {% if footer %}
    <div class="card-footer">
        {{ footer|raw }}
    </div>
    {% endif %}
</div>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Button - Bouton action PrestaShop
 # Usage: {{ ui.button('Save', 'primary', 'save', {'data-action': 'submit'}) }}
 # -------------------------------------------------------------------------- #}
{% macro button(label, type, icon, attrs) %}
{% set type = type|default('primary') %}
{% set attrsHtml = '' %}
{% for key, value in attrs|default({}) %}
    {% set attrsHtml = attrsHtml ~ ' ' ~ key ~ '="' ~ value ~ '"' %}
{% endfor %}
<button type="button" class="btn btn-{{ type }}"{{ attrsHtml|raw }}>
    {% if icon %}<i class="material-icons">{{ icon }}</i> {% endif %}{{ label }}
</button>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Button Link - Lien stylisé en bouton
 # Usage: {{ ui.button_link('View', path('route'), 'primary', 'visibility') }}
 # -------------------------------------------------------------------------- #}
{% macro button_link(label, href, type, icon, attrs) %}
{% set type = type|default('primary') %}
{% set attrsHtml = '' %}
{% for key, value in attrs|default({}) %}
    {% set attrsHtml = attrsHtml ~ ' ' ~ key ~ '="' ~ value ~ '"' %}
{% endfor %}
<a href="{{ href }}" class="btn btn-{{ type }}"{{ attrsHtml|raw }}>
    {% if icon %}<i class="material-icons">{{ icon }}</i> {% endif %}{{ label }}
</a>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Status Badge - Badge de statut actif/inactif
 # Usage: {{ ui.status_badge(item.active) }}
 # Usage: {{ ui.status_badge(item.active, {true: 'Enabled', false: 'Disabled'}) }}
 # -------------------------------------------------------------------------- #}
{% macro status_badge(active, labels) %}
{% set labels = labels|default({true: 'Active', false: 'Inactive'}) %}
{% if active %}
    <span class="badge badge-success">{{ labels[true] }}</span>
{% else %}
    <span class="badge badge-danger">{{ labels[false] }}</span>
{% endif %}
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Badge - Badge générique
 # Usage: {{ ui.badge('New', 'info', true) }}
 # -------------------------------------------------------------------------- #}
{% macro badge(text, variant, pill) %}
{% set variant = variant|default('primary') %}
<span class="badge badge-{{ variant }}{{ pill ? ' badge-pill' : '' }}">{{ text }}</span>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Alert - Message d'alerte
 # Usage: {{ ui.alert('Success!', 'success', 'check_circle', true) }}
 # -------------------------------------------------------------------------- #}
{% macro alert(message, type, icon, dismissible) %}
{% set type = type|default('info') %}
<div class="alert alert-{{ type }}{{ dismissible ? ' alert-dismissible fade show' : '' }}" role="alert">
    {% if icon %}<i class="material-icons mr-2" style="vertical-align: middle;">{{ icon }}</i>{% endif %}
    {{ message }}
    {% if dismissible %}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    {% endif %}
</div>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Empty State - Etat vide avec illustration
 # Usage: {{ ui.empty_state('inbox', 'No items', 'Create your first item', actionButton) }}
 # -------------------------------------------------------------------------- #}
{% macro empty_state(icon, title, message, action) %}
<div class="card">
    <div class="card-body text-center py-5">
        <i class="material-icons d-block mb-3" style="font-size: 48px; color: #6c868e;">{{ icon|default('inbox') }}</i>
        <h4 class="text-muted mb-2">{{ title }}</h4>
        {% if message %}<p class="text-muted mb-3">{{ message }}</p>{% endif %}
        {% if action %}{{ action|raw }}{% endif %}
    </div>
</div>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Loader - Spinner de chargement
 # Usage: {{ ui.loader() }}
 # Usage: {{ ui.loader('sm', 'primary') }}
 # -------------------------------------------------------------------------- #}
{% macro loader(size, variant) %}
{% set size = size|default('md') %}
{% set variant = variant|default('primary') %}
{% set sizeClass = size == 'sm' ? ' spinner-border-sm' : '' %}
<div class="spinner-border text-{{ variant }}{{ sizeClass }}" role="status">
    <span class="sr-only">Loading...</span>
</div>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Loading Overlay - Overlay de chargement sur un conteneur
 # Usage: {{ ui.loading_overlay(isLoading) }}
 # -------------------------------------------------------------------------- #}
{% macro loading_overlay(show) %}
<div class="loading-overlay" style="display: {{ show ? 'flex' : 'none' }}; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.8); align-items: center; justify-content: center; z-index: 10;">
    <div class="spinner-border text-primary" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Icon - Icône Material
 # Usage: {{ ui.icon('settings', 'lg', 'text-primary') }}
 # -------------------------------------------------------------------------- #}
{% macro icon(name, size, class) %}
{% set sizes = {sm: '16', md: '20', lg: '24', xl: '32'} %}
{% set fontSize = sizes[size|default('md')]|default('20') %}
<i class="material-icons{{ class ? ' ' ~ class : '' }}" style="font-size: {{ fontSize }}px; vertical-align: middle;">{{ name }}</i>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Dropdown - Menu déroulant d'actions
 # Usage: {{ ui.dropdown('Actions', 'more_vert', dropdownItems) }}
 # dropdownItems = [{'label': 'Edit', 'href': '#', 'icon': 'edit'}, ...]
 # -------------------------------------------------------------------------- #}
{% macro dropdown(label, icon, items, id) %}
{% set dropdownId = id|default('dropdown-' ~ random()) %}
<div class="dropdown">
    <button class="btn btn-secondary dropdown-toggle" type="button" id="{{ dropdownId }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        {% if icon %}<i class="material-icons">{{ icon }}</i>{% endif %}
        {% if label %} {{ label }}{% endif %}
    </button>
    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="{{ dropdownId }}">
        {% for item in items %}
            {% if item.divider|default(false) %}
                <div class="dropdown-divider"></div>
            {% else %}
                <a class="dropdown-item{{ item.danger|default(false) ? ' text-danger' : '' }}" href="{{ item.href|default('#') }}"{{ item.attrs|default('')|raw }}>
                    {% if item.icon %}<i class="material-icons mr-2" style="font-size: 18px;">{{ item.icon }}</i>{% endif %}
                    {{ item.label }}
                </a>
            {% endif %}
        {% endfor %}
    </div>
</div>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Confirm Button - Bouton avec confirmation
 # Usage: {{ ui.confirm_button('Delete', 'danger', 'delete', 'Are you sure?') }}
 # -------------------------------------------------------------------------- #}
{% macro confirm_button(label, type, icon, message, attrs) %}
{% set type = type|default('danger') %}
{% set message = message|default('Are you sure?') %}
{% set attrsHtml = '' %}
{% for key, value in attrs|default({}) %}
    {% set attrsHtml = attrsHtml ~ ' ' ~ key ~ '="' ~ value ~ '"' %}
{% endfor %}
<button type="button"
        class="btn btn-{{ type }}"
        x-data
        @click="if(confirm('{{ message|e('js') }}')) { $dispatch('confirmed') }"
        {{ attrsHtml|raw }}>
    {% if icon %}<i class="material-icons">{{ icon }}</i> {% endif %}{{ label }}
</button>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Progress Bar - Barre de progression
 # Usage: {{ ui.progress(75, 'success', true) }}
 # -------------------------------------------------------------------------- #}
{% macro progress(value, variant, showLabel) %}
{% set variant = variant|default('primary') %}
{% set value = value|default(0) %}
<div class="progress">
    <div class="progress-bar bg-{{ variant }}" role="progressbar" style="width: {{ value }}%;" aria-valuenow="{{ value }}" aria-valuemin="0" aria-valuemax="100">
        {% if showLabel %}{{ value }}%{% endif %}
    </div>
</div>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Breadcrumb - Fil d'Ariane
 # Usage: {{ ui.breadcrumb([{'label': 'Home', 'href': '/'}, {'label': 'Current'}]) }}
 # -------------------------------------------------------------------------- #}
{% macro breadcrumb(items) %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        {% for item in items %}
            {% if loop.last %}
                <li class="breadcrumb-item active" aria-current="page">{{ item.label }}</li>
            {% else %}
                <li class="breadcrumb-item"><a href="{{ item.href }}">{{ item.label }}</a></li>
            {% endif %}
        {% endfor %}
    </ol>
</nav>
{% endmacro %}

{# -----------------------------------------------------------------------------
 # Tooltip wrapper - Ajout d'un tooltip
 # Usage: {{ ui.tooltip('Hover me', 'This is a tooltip', 'top') }}
 # -------------------------------------------------------------------------- #}
{% macro tooltip(content, title, placement) %}
{% set placement = placement|default('top') %}
<span data-toggle="tooltip" data-placement="{{ placement }}" title="{{ title }}">{{ content|raw }}</span>
{% endmacro %}
