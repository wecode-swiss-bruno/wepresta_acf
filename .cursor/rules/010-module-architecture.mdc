---
description: Architecture Clean pour modules PrestaShop
globs: ["src/**/*.php"]
alwaysApply: true
---

# Architecture Module PrestaShop

## Structure Clean Architecture

```
src/
â”œâ”€â”€ Wedev/             # âš ï¸ NE PAS MODIFIER - Framework WEDEV
â”‚   â”œâ”€â”€ Core/          # Adapters, Traits, Repository abstrait
â”‚   â””â”€â”€ Extension/     # Extensions (UI, EntityPicker, Http...)
â”œâ”€â”€ _example/          # ğŸ“ Exemples Ã  copier puis supprimer
â”œâ”€â”€ Application/       # ğŸ‘¤ Votre code applicatif
â”œâ”€â”€ Domain/            # ğŸ‘¤ Votre code mÃ©tier
â”œâ”€â”€ Infrastructure/    # ğŸ‘¤ Vos implÃ©mentations
â””â”€â”€ Presentation/      # ğŸ‘¤ Vos contrÃ´leurs
```

## RÃ¨gles de DÃ©pendances

```
Presentation â†’ Application â†’ Domain â† Infrastructure
```

- Domain ne dÃ©pend de rien
- Infrastructure implÃ©mente les interfaces du Domain
- Application orchestre Domain + Infrastructure
- Presentation appelle Application

## Conventions

### Fichiers PHP
```php
<?php
declare(strict_types=1);

namespace MonModule\Application\Service;

// Imports groupÃ©s: PHP natif, Symfony, PrestaShop, Module
use DateTimeImmutable;
use Symfony\Component\DependencyInjection\ContainerInterface;
use PrestaShop\PrestaShop\Core\Module\Module;
use MonModule\Domain\Entity\MonEntite;
```

### Classes
| Type | Convention | Exemple |
|------|-----------|---------|
| Entity | Singulier, PascalCase | `Product`, `Order` |
| Repository | Interface + Impl | `ProductRepositoryInterface`, `ProductRepository` |
| Service | Suffixe Service | `ProductService`, `PriceCalculatorService` |
| Exception | Suffixe Exception | `EntityNotFoundException` |

### Dossiers
- `Application/Command/` - Commandes CQRS (Ã©criture)
- `Application/Query/` - Queries CQRS (lecture)
- `Application/Service/` - Services applicatifs
- `Domain/Entity/` - EntitÃ©s mÃ©tier
- `Domain/Repository/` - Interfaces repository
- `Infrastructure/Repository/` - ImplÃ©mentations repository

## Anti-Patterns Ã  Ã‰viter

```php
// âŒ NE PAS accÃ©der Ã  Db directement dans Domain
class Product {
    public function save() {
        Db::getInstance()->insert(...); // INTERDIT
    }
}

// âœ… Utiliser le Repository
class ProductService {
    public function create(Product $product): int {
        return $this->repository->save($product);
    }
}
```

## Services Symfony

```yaml
# config/services.yml
services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false

    MonModule\Application\:
        resource: '../src/Application/*'

    MonModule\Infrastructure\:
        resource: '../src/Infrastructure/*'
```
