---
description: Extension Import WEDEV - Import/Export de donnÃ©es
globs: ["**/Extension/Import/**/*.php"]
alwaysApply: false
---

# Extension Import WEDEV

## ðŸŽ¯ Objectif

Framework d'import/export de donnÃ©es avec support CSV, JSON, XML.

## ðŸ“¦ Composants

| Composant | RÃ´le |
|-----------|------|
| `AbstractImporter` | Classe de base import |
| `AbstractExporter` | Classe de base export |
| `ImportResult` | RÃ©sultat d'import |
| `Parser/*` | Parsers (CSV, JSON, XML) |

## âœ… Bonnes Pratiques

### CrÃ©er un Importeur

```php
// âœ… BON: Ã‰tendre AbstractImporter
final class ProductImporter extends AbstractImporter
{
    protected function getRequiredColumns(): array
    {
        return ['reference', 'name', 'price'];
    }

    protected function processRow(array $row, int $lineNumber): void
    {
        $this->validateRow($row, $lineNumber);

        if ($this->dryRun) {
            return;  // Ne rien modifier en dry-run
        }

        // Logique d'import...
        $this->result->incrementCreated();
    }
}
```

### Gestion des Erreurs

```php
// âœ… BON: Reporter les erreurs sans interrompre
protected function processRow(array $row, int $lineNumber): void
{
    try {
        $this->validateRow($row, $lineNumber);
        // Import...
    } catch (\Throwable $e) {
        $this->result->addError($lineNumber, $e->getMessage());
        $this->result->incrementSkipped();
    }
}
```

### Mode Dry-Run

```php
// âœ… BON: Toujours supporter le dry-run
$importer->setDryRun(true);
$result = $importer->import($file);

// Afficher ce qui SERAIT importÃ©
echo "Would create: " . $result->getCreated();
echo "Would update: " . $result->getUpdated();
```

### Progression

```php
// âœ… BON: Reporter la progression
$importer->onProgress(function(int $current, int $total) {
    $percent = round($current / $total * 100);
    echo "\r{$percent}%";
});
```

### Imports Lourds

```php
// âœ… BON: Utiliser les jobs pour les gros imports
$dispatcher->dispatch(new ImportProductsJob($filePath));

// âœ… BON: Limiter la taille des batches
$importer->setBatchSize(100);
```

## ðŸš« Anti-patterns

```php
// âŒ Charger tout en mÃ©moire
$data = json_decode(file_get_contents($hugeFile), true);

// âœ… BON: Utiliser les generators pour l'export
protected function getData(): iterable
{
    foreach ($this->fetchBatch() as $row) {
        yield $row;  // Pas de chargement total
    }
}

// âŒ Ignorer les colonnes requises
protected function getRequiredColumns(): array
{
    return [];  // Aucune validation!
}

// âŒ Pas de gestion d'erreurs
$result = $importer->import($file);
// Continuer sans vÃ©rifier...
```

## ðŸ“Š Export avec TÃ©lÃ©chargement

```php
// Controller
public function exportAction(): Response
{
    $exporter = new ProductExporter();

    return new Response(
        $exporter->exportToString(),
        200,
        [
            'Content-Type' => $exporter->getContentType(),
            'Content-Disposition' => 'attachment; filename="products.' . $exporter->getFileExtension() . '"',
        ]
    );
}
```
